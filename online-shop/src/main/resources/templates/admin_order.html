<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<header>
  <h1>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
  <nav>
    <ul>
      <li><a href="/admin/products">–¢–æ–≤–∞—Ä—ã</a></li>
      <li><a href="/admin/orders">–ó–∞–∫–∞–∑—ã</a></li>
      <li><a href="/admin/news">–ù–æ–≤–æ—Å—Ç–∏</a></li>
      <li><a href="/logout">–í—ã–π—Ç–∏</a></li>
    </ul>
  </nav>
</header>

<h2 class="admin-h2">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</h2>

<div id="update-order-form" class="modal" style="display: none;">
  <div class="modal-content">
    <span class="close-button">&times;</span>
    <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
    <form action="/admin/orders/update" method="post">
      <input type="hidden" id="id" name="id">

      <div class="form-group">
        <label for="customerName">–í–∞—à–µ –∏–º—è:</label>
        <input type="text" id="customerName" name="customerName" required>
      </div>

      <div class="form-group">
        <label for="birthDate">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</label>
        <input type="date" id="birthDate" name="birthDate" required>
      </div>

      <div class="form-group">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
      </div>

      <div class="form-group">
        <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
        <input type="tel" id="phone" name="phone" required>
      </div>

      <div class="form-group">
        <label for="tankNick">–¢–∞–Ω–∫–æ–≤—ã–π –Ω–∏–∫:</label>
        <input type="text" id="tankNick" name="tankNick" required>
      </div>

      <div id="products-container">
        <div class="form-group product-group">
          <label for="product">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä:</label>
          <select id="product" name="product" required onchange="updateForm()">
            <option value="" data-price="0" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä</option>
            <option th:each="product : ${products}" th:value="${product.id}" th:data-price="${product.price}" th:text="${product.title}"></option>
          </select>
          <label for="quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
          <input id="quantity" type="number" name="quantity" min="0" value="" required oninput="this.value = this.value.replace(/[^0-9]/g, ''); updateForm();">
        </div>
      </div>

      <div class="form-group">
        <label for="paymentMethod">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</label>
        <select id="paymentMethod" name="paymentMethod">
          <option value="card">–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</option>
          <option value="wallet">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –∫–æ—à–µ–ª–µ–∫</option>
          <option value="crypto">–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</option>
        </select>
      </div>

      <div class="form-group">
        <label for="comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
        <textarea id="comment" name="comment" rows="3"></textarea>
      </div>

      <div class="form-group">
        <label for="total-price">–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</label>
        <span id="total-price">0 —Ä—É–±.</span>
      </div>

      <button type="submit" class="submit-button">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </form>
  </div>
</div>

<table class="admin-table">
  <tr>
    <th>–ò–º—è</th>
    <th>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</th>
    <th>–ü–æ—á—Ç–∞</th>
    <th>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</th>
    <th>–ù–∏–∫</th>
    <th>–û–ø–ª–∞—Ç–∞</th>
    <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
    <th>–¢–æ–≤–∞—Ä</th>
    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
  </tr>
  <tr th:each="order : ${orders}" id="order-row-[[${order.id}]]">
    <td th:text="${order.name}"></td>
    <td th:text="${order.birthDate}"></td>
    <td th:text="${order.email}"></td>
    <td th:text="${order.phone}"></td>
    <td th:text="${order.nickname}"></td>
    <td th:text="${order.paymentMethod}"></td>
    <td th:text="${order.comment}"></td>
    <td th:text="${order.product}"></td>
    <td th:text="${order.quantity}"></td>
    <td>
      <button type="button" onclick="openUpdateForm(this)"
              th:attr="id=${order.id}, name=${order.name}, email=${order.email}, birthDate=${order.birthDate}, phone=${order.phone},
              nickname=${order.nickname}, paymentMethod=${order.paymentMethod}, comment=${order.comment}, product=${order.product}, quantity=${order.quantity}">
        ‚úè –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
      </button>
      <button class="delete-button" th:attr="data-id=${order.id}" onclick="confirmDelete(this)">üóë –£–¥–∞–ª–∏—Ç—å</button>
    </td>
  </tr>
</table>

<script>
  document.querySelectorAll('.close-button').forEach(button => {
    button.addEventListener('click', function () {
      document.getElementById('update-order-form').style.display = 'none';
    });
  });

  function openUpdateForm(button) {
    document.getElementById('id').value = button.getAttribute('id')
    document.getElementById('customerName').value = button.getAttribute('name');
    document.getElementById('birthDate').value = button.getAttribute('birthDate');
    document.getElementById('email').value = button.getAttribute('email');
    document.getElementById('phone').value = button.getAttribute('phone');
    document.getElementById('tankNick').value = button.getAttribute('nickname');
    document.getElementById('paymentMethod').value = button.getAttribute('paymentMethod');
    document.getElementById('comment').value = button.getAttribute('comment');
    document.getElementById('product').value = button.getAttribute('product');
    document.getElementById('quantity').value = button.getAttribute('quantity');

    document.getElementById('update-order-form').style.display = 'flex';
  }

  function confirmDelete(button) {
    let orderId = button.getAttribute("data-id");
    if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑?")) {
      window.location.href = "/admin/orders/delete/" + orderId;
    }
  }
</script>
</body>
</html>
